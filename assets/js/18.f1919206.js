(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{374:function(s,t,a){"use strict";a.r(t);var n=a(44),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")]),s._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("Re")]),s._v("mote "),a("strong",[s._v("Di")]),s._v("cationary "),a("strong",[s._v("S")]),s._v("erver:远程字典服务")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis官网"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[s._v("#")]),s._v(" 作用")]),s._v(" "),a("ol",[a("li",[s._v("内存存储、持久化，内存一断电就没了所以持久化很重要。（rdb、aof）")]),s._v(" "),a("li",[s._v("效率高、可以用来高速缓存")]),s._v(" "),a("li",[s._v("发布订阅系统")]),s._v(" "),a("li",[s._v("地图信息分享")]),s._v(" "),a("li",[s._v("计时器、计数器")])]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("启动redis-server.exe")])]),s._v(" "),a("li",[a("p",[s._v("打开redis-cli.exe")]),s._v(" "),a("p",[s._v("简单的set get")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nPONG\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key1 name1\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get key1\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("Linux安装")]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("下载安装包  "),a("code",[s._v("redis-5.0.8.tar.gz")])])]),s._v(" "),a("p",[s._v("街道redis的安装包，到/opt目录下")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" redis-5.0.5.tar.gz /opt\n")])])]),a("ul",[a("li",[s._v("解压")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf redis-5.0.5.tar.gz \n")])])]),a("p",[a("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-111120.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("安装gcc：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc-c++\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再一次")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),a("ul",[a("li",[s._v("redis 默认路径 ： "),a("code",[s._v("usr/local/bin")])])]),s._v(" "),a("p",[s._v("把配置文件copy到自己的 "),a("code",[s._v("usr/local/bin/myconfig")]),s._v("目录")]),s._v(" "),a("ul",[a("li",[s._v("设置为后台启动")])]),s._v(" "),a("p",[s._v("去自己的redis.config 把daemonize no 改为yes")]),s._v(" "),a("p",[s._v("在bin下运行  "),a("code",[s._v("redis-server myconfig/redis.conf")])]),s._v(" "),a("p",[s._v("使用客户端连接： "),a("code",[s._v("redis-cli -p 6379")])])])])]),s._v(" "),a("h1",{attrs:{id:"基础知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础知识"}},[s._v("#")]),s._v(" 基础知识")]),s._v(" "),a("p",[s._v("​\t\t"),a("a",{attrs:{href:"http://www.redis.cn/commands.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis 命令"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[a("p",[s._v("redis有16个数据库，默认使用第0个，可以使用select切换数据库。")]),s._v(" "),a("p",[a("strong",[s._v("select  3")]),s._v("：选择三号数据库")]),s._v(" "),a("p",[a("strong",[s._v("DBSIZE")]),s._v(":\t查看大小")])]),s._v(" "),a("li",[a("p",[s._v("查看某数据库所有的key")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" keys *\n")])])])]),s._v(" "),a("li",[a("p",[s._v("清空")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flushdb "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#清空当前db")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flushall "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空所有")]),s._v("\n")])])])])]),s._v(" "),a("h3",{attrs:{id:"单线程的redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单线程的redis"}},[s._v("#")]),s._v(" 单线程的Redis")]),s._v(" "),a("p",[s._v("redis是很快的，官方表示Redis是"),a("strong",[s._v("基于内存")]),s._v("操作的，CPU不是Redis的性能瓶颈，Redis的瓶颈是根据计算机的内存和网络带宽决定的，既然可以使用单线程来实现，就使用单线程。")]),s._v(" "),a("blockquote",[a("p",[s._v("为什么 Redis 这么快")])]),s._v(" "),a("p",[s._v("Redis 是C语言写的，官方提供的数据为 100000 +  QPS，完全不必使用key-value的Memecache差！")]),s._v(" "),a("blockquote",[a("p",[s._v("为什么单线程还快")])]),s._v(" "),a("p",[s._v("误区1：高性能服务器一定是多线程")]),s._v(" "),a("p",[s._v("误区2：多线程一定比单线程效率高 （CPU会上下文切换回！）")]),s._v(" "),a("blockquote",[a("p",[s._v("redis 把数据都放在内存中")])]),s._v(" "),a("p",[s._v("所以使用单线程操作效率高，对于内存系统来说没有上下文切换的效率就是最高的！多次读写都在一个CPU上")]),s._v(" "),a("p",[s._v("redis可以做数据库、缓存、消息中间件MQ。")]),s._v(" "),a("h3",{attrs:{id:"五大基础类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五大基础类型"}},[s._v("#")]),s._v(" 五大基础类型")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis-key")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("exists name1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断key是否存在")]),s._v("\nmove name1  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移动到1号数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value\nget key\nexpire name1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#name键10s过期")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" name1   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看类型")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("String")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("append key "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#追加，若不存在相当于set")]),s._v("\nstrlen key "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#得到长度")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####")]),s._v("\n\nincr views "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给一个数字 +1")]),s._v("\ndecr views "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给一个数字-1")]),s._v("\nincrby views "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#10步长")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####")]),s._v("\n\ngetrange name "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#截取字符串")]),s._v("\ngetrange name "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看全部")]),s._v("\nsetrange name "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" XXX "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在name的0位置插入")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####")]),s._v("\nsetex key2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" hello "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置30s过期")]),s._v("\nsetnx key2 redis "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不存在该key才设置，若存在则失败")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##### 批量操作")]),s._v("\nmset key1 c1 key2 c2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#批量设置")]),s._v("\nmget  key1 k2 k3 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#批量获取")]),s._v("\nmsetnx k4 v4  k5 v5 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#原子性操作，一起成功/失败")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##对象")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" user:1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name:zhangsan,age:12"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置对象保存为字符串")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" user:1:name  gao "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user[1].name=gao")]),s._v("\n \n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###组合")]),s._v("\n getset db redis "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先拿到原来的再设置新的，若不存在返回NULL")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("List")])]),s._v(" "),a("p",[s._v("列表：可以当做栈，队列。其本质是链表。list操作都是L开头的")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("lrange list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得队列的值")]),s._v("\n\n\nlpush list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(栈形式)后放的在上面，先放的在下面")]),s._v("\nrpush list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(队列形式) 先放的在上面，后方的在下面")]),s._v("\n\n\nlpop list "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#左移除一个")]),s._v("\nrpop list "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#右移除一个")]),s._v("\n\nlrem list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  XXX "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\nlindex list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得下标为3")]),s._v("\nLlen  list "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得长度")]),s._v("\n\n\nlrem list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" one "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除list中两个值为one的元素")]),s._v("\nltrim list "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#截指定长度，从list2[1]开始的两个元素")]),s._v("\n\n\nrpoplpush list1 list2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除最后一个元素将他移动到新的列表中。")]),s._v("\nlset list  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  otherValue "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将list[1]的值改为otherValue,若不存在则报错")]),s._v("\n\n linsert list2 before hello1.5 hello1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在hello1.5前插入hello1")]),s._v("\n\n")])])]),a("blockquote",[a("p",[s._v("Set（集合）")])]),s._v(" "),a("p",[s._v("Set中的值不可重复，指令以S开头。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sadd myset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加元素")]),s._v("\nsmemebers myset "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定查看所有值")]),s._v("\nsismember myset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断集合中是否有1元素")]),s._v("\nscard myset \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取值")]),s._v("\nsrem myset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除1元素")]),s._v("\nsrandmember myset  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得一个随机元素 ")]),s._v("\nspop myset "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#随机弹出set元素")]),s._v("\nsmove  set1 set2  hello  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把set1的hello移动到set2中")]),s._v("\n")])])]),a("p",[s._v("例：共同关注（交集）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sdiff")]),s._v(" set1 set2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#差集  set1-set2")]),s._v("\ndinter set1 set2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#交集")]),s._v("\nsunion set1 set2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#并集")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("Hash（哈希）")])]),s._v(" "),a("p",[s._v("Map,key-Map集合。以h开头，本质和 String没有太大区别还是k-v对。")]),s._v(" "),a("p",[s._v("应用：hash 变更的数据user name  age,尤其是用户信息之类的，经常变动的信息。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hset "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" field1 gao "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#存")]),s._v("\nhget "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" field1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#取")]),s._v("\n\nhmset "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v("  f1 v1 f2 v2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set多个字段")]),s._v("\nhmget "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" f1 f2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#get多个字段")]),s._v("\n\nhgetall "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得所有")]),s._v("\nhdel "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" f1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除hash指定的key字段")]),s._v("\n\nhlen "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取hash长度")]),s._v("\n\nhexists myhash f1"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断hash中指定的字段是否存在")]),s._v("\n\nhkeys "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得所有")]),s._v("\nhvals "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v("\n\n\nhincrby "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" f1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#f1的值自增1")]),s._v("\n\nhsetnx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" f1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#若存在则不能设置，不存在则可以")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("Zset （有序集合）")])]),s._v(" "),a("p",[s._v("在set的基础上增加了一个计数位")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hsetnx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" f1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" zadd zset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" one "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" two "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" three\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" zrange zset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"one"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"two"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"three"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#排序")]),s._v("\nZRANGEBYSCORE zset -inf +inf\nzrevrange  zset "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#倒叙")]),s._v("\nwithscores"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定范围排序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#withscores表示带序号")]),s._v("\n\n\nzrem zset one  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除有序集合中的指定元素")]),s._v("\nzcard zset "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获得有序集合中个数")]),s._v("\n\nzcount zset  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取区间的成员数量")]),s._v("\n")])])]),a("p",[s._v("案例：工资表。给消息设置权重")]),s._v(" "),a("h3",{attrs:{id:"三种特殊类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三种特殊类型"}},[s._v("#")]),s._v(" 三种特殊类型")]),s._v(" "),a("h4",{attrs:{id:"geospatial-地理位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geospatial-地理位置"}},[s._v("#")]),s._v(" geospatial 地理位置")]),s._v(" "),a("p",[s._v("用于附近的人，定位...")]),s._v(" "),a("p",[s._v("这个功能可以推算两地之间的距离和附近的人。")]),s._v(" "),a("blockquote",[a("p",[s._v("6 个命令")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("geoadd china:shanghai "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.45")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.23")]),s._v(" jingan  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加一个地理位置")]),s._v("\ngeodist china:shanghai huangpu yangpu  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#返回两地距离")]),s._v("\ngeopos china:shanghai yangpu\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取经纬度")]),s._v("\n\ngeoradius china:shanghai "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.51")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.26")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" km  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在上海这个集合中找里[121.51,31.26] 10km 的地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WITHDIST: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WITHCOORD: 将位置元素的经度和维度也一并返回。")]),s._v("\n\n\ngeoradiusbymember china:shanghai huangpu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" km\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#找出位置与指定元素周围的其他元素")]),s._v("\n\ngeohash china:shanghai yangpu \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#返回hash值，把二维经纬度转化为以为字符串")]),s._v("\n")])])]),a("p",[s._v("原理：底层的实现就是Zset，我可意义使用Zset操作geo，所有可以使用zrem 移除某地点")]),s._v(" "),a("h4",{attrs:{id:"hyperloglogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglogs"}},[s._v("#")]),s._v(" Hyperloglogs")]),s._v(" "),a("blockquote",[a("p",[s._v("基数：在一个数据集内，不重复的元素")])]),s._v(" "),a("p",[s._v("Redis Hyperloglog :基数统计的算法。")]),s._v(" "),a("p",[s._v("2^64 不同元素的计数，只要12kb的内存，如果从内存角度来比较的话Hyperloglog是首选。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("案例：网页浏览量，一人访问多次还是算一个人")]),s._v(" "),a("p",[s._v("传统方法：set保存用户id，然后就可以统计set中的元素熟料作为标准判断。")]),s._v(" "),a("p",[s._v("这个方法如果保存大量用户id，就会比较麻烦。我们的目的只是为了计数，而不是保存用户id。")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("PFadd hyperlog a b c d e f g h i j\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加")]),s._v("\n\npfcount mykey "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#元素个数")]),s._v("\n\npfmerge hl3 hl1 hl2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#合并两个数据集")]),s._v("\n")])])]),a("h4",{attrs:{id:"bitmaps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitmaps"}},[s._v("#")]),s._v(" Bitmaps")]),s._v(" "),a("blockquote",[a("p",[s._v("位存储")])]),s._v(" "),a("p",[s._v("用二进制位来进行记录，只有0/1两个状态。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("setbit sign "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit sign "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nsetbit sign "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ngetbit sign "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nbitcount sign "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#统计记录")]),s._v("\n")])])]),a("h2",{attrs:{id:"事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[s._v("#")]),s._v(" 事务")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis 事务：一组命令的集合")])]),s._v(" "),a("p",[s._v("一个事务中的所有命令都会被序列化，按照顺序执行。")]),s._v(" "),a("p",[s._v("保证 一次性、顺序性、排他性。")]),s._v(" "),a("p",[s._v("Redis 单条命令保证原子性，但是事务不保证"),a("strong",[s._v("原子性")]),s._v("，且"),a("strong",[s._v("没有隔离级别")]),s._v("的概念。所有命令在事务中，并没有直接被执行，只有发起执行命令的时候才会执行 Eexc。")]),s._v(" "),a("h3",{attrs:{id:"事务流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务流程"}},[s._v("#")]),s._v(" 事务流程")]),s._v(" "),a("blockquote",[a("p",[s._v("正常使用事务")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("开始事务")]),s._v(" "),a("p",[a("code",[s._v("multi")])])]),s._v(" "),a("li",[a("p",[s._v("命令入队")]),s._v(" "),a("p",[s._v("输入各种语句.....")])]),s._v(" "),a("li",[a("p",[s._v("执行事务")]),s._v(" "),a("p",[s._v("exec")])])]),s._v(" "),a("blockquote",[a("p",[s._v("放弃事务")])]),s._v(" "),a("p",[a("code",[s._v("discard")]),s._v(":开启事务后，写的命令都不会生效了")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k6 v6\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" discard\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" \n\n")])])]),a("blockquote",[a("p",[s._v("命令异常时，事务中所有的命令都不会被执行，会被discard")])]),s._v(" "),a("blockquote",[a("p",[s._v("运行时异常，如果事务在存在异常，其他命令是会被执行的，该命令不会被执行。")])]),s._v(" "),a("h2",{attrs:{id:"锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁"}},[s._v("#")]),s._v(" 锁")]),s._v(" "),a("h3",{attrs:{id:"乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁"}},[s._v("#")]),s._v(" 乐观锁")]),s._v(" "),a("p",[s._v("很乐观，认为什么时候都不会出现问题，所以不会上锁。更新数据的时候去判断，在这个期间内是否有人"),a("strong",[s._v("改动")]),s._v(" 过该数据，(version)")]),s._v(" "),a("ul",[a("li",[s._v("获得version")]),s._v(" "),a("li",[s._v("更新时比较 version")])]),s._v(" "),a("h3",{attrs:{id:"悲观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#悲观锁"}},[s._v("#")]),s._v(" 悲观锁")]),s._v(" "),a("p",[s._v("很悲观，觉得什么时候都会出现问题。无论什么都加锁，如synchronized")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis 监控测试")])]),s._v(" "),a("p",[s._v("事务正常结束，执行成功")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" money\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监视对象")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" decrby money "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" \nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" incrby out "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("修改失败")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" money\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" decrby money "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" incrby out "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("watch：相当于乐观锁，会拿到money的值，一旦money的值被修改，那么事务不会成功。")]),s._v(" "),a("p",[s._v("另一个线程把money进行了修改。由于主线程用watch监视了money，主线程中的事务就会执行失败。")]),s._v(" "),a("blockquote",[a("p",[s._v("执行失败要解锁，重新watch")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" unwatch\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get money\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" money\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" decrby money "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" incrby out "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"jedis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jedis"}},[s._v("#")]),s._v(" Jedis")]),s._v(" "),a("blockquote",[a("p",[s._v("jedis ：redis 官方推荐的java链接开发工具、java操作redis的中间件。")])]),s._v(" "),a("h3",{attrs:{id:"环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境配置"}},[s._v("#")]),s._v(" 环境配置")]),s._v(" "),a("ol",[a("li",[s._v("导入依赖")])]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("redis.clients"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.2.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("com.alibaba"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("fastjson"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.2.62"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("测试")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("配置安全组，关闭防火墙")])]),s._v(" "),a("li",[a("p",[s._v("连接数据库")])]),s._v(" "),a("li",[a("p",[s._v("操作命令")])]),s._v(" "),a("li",[a("p",[s._v("断开连接")])])])])]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" jedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"182.92.112.81"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" java "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("move")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"整合-springboot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整合-springboot"}},[s._v("#")]),s._v(" 整合 SpringBoot")]),s._v(" "),a("p",[s._v("在SpringBoot 2.X后，原来使用的jedis被替换为了lettuce。")]),s._v(" "),a("p",[s._v("jedis：采用的直连，过个线程操作的话是不安全的，如果想要避免要是用jedis pool 连接池。更像 BIO 模式")]),s._v(" "),a("p",[s._v("lettuce：采用netty，实例可以在多个线程中进行共享，不存在线程不安全的情况，可以减少线程数据了，更像 NIO模式")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ConditionalOnMissingBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redisTemplate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redisTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConnectionFactory")]),s._v(" redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//默认的RedisTemple 没有过多的设置，redis对象是需要序列化的。")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//两个泛型都是object，需要强转")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" template "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\ttemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnectionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ConditionalOnMissingBean")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisTemplate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringRedisTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConnectionFactory")]),s._v(" redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisTemplate")]),s._v(" template "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\ttemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnectionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("整合测试")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("导入依赖")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-data-redis"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("配置链接")])])]),s._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# springboot 所有的配置类，都有一个自动配置类，会绑定一个properties文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("6379")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("82.92.112.81")]),s._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("测试")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootTest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisApplicationTests")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("contextLoads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//redisTemplate")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//opsForValue 操作字符串，类似String")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//opsForList  操作List ，类似List")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ops……操作各种数据")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValueOperations")]),s._v(" valueOperations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        valueOperations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spring-redis"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lettuce"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("这里使用了默认的redistemplate，其中使用的是"),a("code",[s._v("JdkSerializationRedisSerializer")]),s._v("对数据进行序列化操作而造成了乱码，所有需要自己重写redistemplate")])])]),s._v(" "),a("ul",[a("li",[s._v("解决方法")])]),s._v(" "),a("p",[s._v("方法一：传递json字符串")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JsonProcessingException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValueOperations")]),s._v(" valueOperations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gao"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//序列化")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" jsonUser "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeValueAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        valueOperations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("jsonUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("valueOperations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("方法二：若想传递对象必须要对对象进行序列化")]),s._v(" "),a("p",[s._v("默认为jdk方式")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" valueOperations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("valueOperations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("如果我们不想使用jdk的序列化方式，我们就需要重写redistemplate")]),s._v(" "),a("p",[s._v("写自己的"),a("strong",[s._v("redisconfiguration")]),s._v("，在其中配置自己的序列化方法")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SuppressWarnings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConfig")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redisTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConnectionFactory")]),s._v(" redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" template "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnectionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisConnectionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//配置自己的序列化方式")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" jacksonSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setKeySerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jacksonSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),s._v(" om "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setVisibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PropertyAccessor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JsonAutoDetect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Visibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ANY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enableDefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NON_FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jacksonSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//所有key采用 string方式序列化，value采用jackson")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisSerializer")]),s._v(" stringRedisSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setKeySerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stringRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHashKeySerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stringRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValueSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jacksonSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("afterPropertiesSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("测试类中导入自己写的配置")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Qualifier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redisTemplate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h1",{attrs:{id:"redis-进阶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-进阶"}},[s._v("#")]),s._v(" Redis 进阶")]),s._v(" "),a("h2",{attrs:{id:"redis-conf-详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-conf-详解"}},[s._v("#")]),s._v(" Redis.conf 详解")]),s._v(" "),a("p",[s._v("对大小写不明感")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-111020.png",alt:""}})]),s._v(" "),a("p",[s._v("可以导入外部配置")]),s._v(" "),a("blockquote",[a("p",[s._v("网络")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#绑定ip")]),s._v("\nprotect-mode  no "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保护模式")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("通用")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("daemonize "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以守护进程的方式运行，后台运行")]),s._v("\n\npidfile /var/run/redis_6379.pid "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果以后台运行就要指定pid文件")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the server verbosity level.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This can be one of:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# debug (a lot of information, useful for development/testing)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# verbose (many rarely useful info, but not a mess like the debug level)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# notice (moderately verbose, what you want in production probably)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# warning (only very important / critical messages are logged)")]),s._v("\nloglevel notice\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成日志的文件名")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the log file name. Also the empty string can be used to force")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis to log on the standard output. Note that if you use standard")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# output for logging but daemonize, logs will be sent to /dev/null")]),s._v("\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n\n")])])]),a("blockquote",[a("p",[s._v("快照")])]),s._v(" "),a("p",[s._v("持久化，在规定时间内执行了多少次操作，则会持久化到文件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110857.png",alt:""}})]),s._v(" "),a("p",[s._v("900s之内，如果至少一个key修改了就会持久化。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#持久化出错是否继续执行")]),s._v("\nstop-writes-on-bgsave-error "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否压缩drb文件")]),s._v("\nrdbcompression "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" ./ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rdb文件保存目录")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("append only 模式    aof配置")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("appendonly no "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认不开启aof，因为大部分所有的情况家rdb完全够用")]),s._v("\nappendfilename "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly.aof"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认aof文件")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync always 每次修改都会同步，消耗性能")]),s._v("\nappendfsync everysec  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒同步，可能会都是数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync no  #不同步，os自己同步，速度最快")]),s._v("\n\n")])])]),a("h2",{attrs:{id:"redis-持久化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化"}},[s._v("#")]),s._v(" Redis 持久化")]),s._v(" "),a("blockquote",[a("p",[s._v("RDB 与 AOF")])]),s._v(" "),a("p",[s._v("Redis 是内存数据库，所以要交内存中的数据保存到磁盘。故redis提供了持久化功能。")]),s._v(" "),a("h3",{attrs:{id:"rdb-fork进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rdb-fork进程"}},[s._v("#")]),s._v(" RDB：fork进程")]),s._v(" "),a("p",[s._v("在指定的时间间隔内将内存中的数据集快照写入磁盘（snapshot），恢复是将快照直接读到内存中。")]),s._v(" "),a("p",[s._v("redis会单独创建一个子进程持久化，它把数据写到临时文件中，持久化结束了，用这个临时文件替换之前的文件。")]),s._v(" "),a("p",[s._v("我们"),a("strong",[s._v("默认使用rdb")]),s._v("，一般情况下不需要修改这个配置。")]),s._v(" "),a("p",[s._v("rdb保存的文件是dump.rdb")]),s._v(" "),a("blockquote",[a("p",[s._v("触发机制")])]),s._v(" "),a("ol",[a("li",[s._v("save 的规则满足的情况下，会自动触发rdb规则")]),s._v(" "),a("li",[s._v("flushall也会触发")]),s._v(" "),a("li",[s._v("退出redis")])]),s._v(" "),a("blockquote",[a("p",[s._v("恢复rdb文件")])]),s._v(" "),a("p",[s._v("​\t只要把dump.rdb 放在redis启动目录下就可以，redis启动会自动检查")]),s._v(" "),a("blockquote",[a("p",[s._v("优劣")])]),s._v(" "),a("p",[s._v("优点：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("适合大规模的数据恢复")])]),s._v(" "),a("li",[a("p",[s._v("若对数据的完整性不高，可以使用")])])]),s._v(" "),a("p",[s._v("缺点：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("需要一定时间间隔进行操作，如果redis意外宕机了，最后一次修改数据就没有了")])]),s._v(" "),a("li",[a("p",[s._v("fork 子进程需要单独的空间")])])]),s._v(" "),a("h3",{attrs:{id:"aof-append-only-file-读写文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aof-append-only-file-读写文件"}},[s._v("#")]),s._v(" AOF （append only file）：读写文件")]),s._v(" "),a("p",[s._v("以日志的形式来记录每个写操作，把redis所有执行过的指令都记录下来。"),a("strong",[s._v("只追加，不改写")]),s._v("。记录到 appendonly.aof中")]),s._v(" "),a("p",[s._v("若要开启，去配置文件修改：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("appendonly no "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认不开始，需要改为yes")]),s._v("\n")])])]),a("p",[s._v("若appendonly.aof被破坏，可以使用redis-check-aof 修复")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-check-aof --fix appendonly.aof\n")])])]),a("p",[s._v("优点：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync always 每次修改都会同步，消耗性能")]),s._v("\nappendfsync everysec  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒同步，可能会都是数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync no  #不同步，os自己同步，速度最快")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[s._v("每一次修改都追加，文件完整性会更加好")])]),s._v(" "),a("li",[a("p",[s._v("每一秒同步一次可能会都是一秒的数据")])]),s._v(" "),a("li",[a("p",[s._v("从不同步，效率最高")])])]),s._v(" "),a("p",[s._v("缺点：")]),s._v(" "),a("ul",[a("li",[s._v("相对于数据文件来说，aof远远大于edb，修复速度慢")]),s._v(" "),a("li",[s._v("aof 运行效率也比rdb慢")])]),s._v(" "),a("h2",{attrs:{id:"redis-发布订阅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-发布订阅"}},[s._v("#")]),s._v(" Redis 发布订阅")]),s._v(" "),a("p",[s._v("redis 发布订阅是一种"),a("strong",[s._v("消息通信模式")]),s._v("。发送者发消息，订阅者接收。")]),s._v(" "),a("blockquote",[a("p",[s._v("命令")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("psubsribe paettern "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#订阅")]),s._v("\n\npubsub subcommand "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("argument "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("argument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看订阅与发布系统状态")]),s._v("\n\npublish channnel message "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送信息")]),s._v("\n\npunsubsribe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退订所有给定模式的频道")]),s._v("\n\nsubsribe channel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#订阅给定的一个或多个频道信息")]),s._v("\n\nunsubsribe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退订给定的频道")]),s._v("\n")])])]),a("p",[s._v("只要订阅了，一旦发布立马被推送。")]),s._v(" "),a("h2",{attrs:{id:"redis-主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从复制"}},[s._v("#")]),s._v(" Redis 主从复制")]),s._v(" "),a("p",[s._v("一台redis服务器(主节点)的数据，复制到其他的redis服务器（从节点）中。 数据只能从主节点复制到从节点是单向的。")]),s._v(" "),a("blockquote",[a("p",[s._v("主要作用")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("数据冗余：实现了数据的热备份，是持久化之外的一种数据冗余方式")])]),s._v(" "),a("li",[a("p",[s._v("故障恢复：主节点出问题时，从节点服务。")])]),s._v(" "),a("li",[a("p",[s._v("负载均衡：在主从复制的基础上，配合读写分离，主节点写，从节点读。分担服务器的负载。在写少读多的场景下，通过多个节点分担读负载，从而提高并发量")])]),s._v(" "),a("li",[a("p",[s._v("高可用(集群)：主从复制是哨兵模式和集群能够实施的基础")])])]),s._v(" "),a("p",[s._v("一般来说，工程项目中由于只有一台服务redis会宕机，单台redis内存最大使用"),a("strong",[s._v("内存不超过20gb")]),s._v("，所有必须配置集群。一般来说都是一主二从。")]),s._v(" "),a("blockquote",[a("p",[s._v("环境配置")])]),s._v(" "),a("p",[s._v("配置从库")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("info replication "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看redis当前库的信息")]),s._v("\n\n")])])]),a("p",[s._v("复制三个配置文件，配置一主二从的配置")]),s._v(" "),a("p",[s._v("修改每个配置文件的端口、pid、log文件、rdb文件名字")]),s._v(" "),a("blockquote",[a("p",[s._v("一主二从")])]),s._v(" "),a("p",[s._v("将6379作为主机，6380,6381作为从机")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("slaveof "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置从机")]),s._v("\n")])])]),a("p",[s._v("真实的主从配置要在配置文件中配置，用命令是暂时的")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" replicaof "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),a("blockquote",[a("p",[s._v("tips")])]),s._v(" "),a("p",[s._v("主机只能写，从机只能读。")]),s._v(" "),a("p",[s._v("主机的信息会被从机保存。")]),s._v(" "),a("p",[s._v("如果主机宕机了，想要让从机接替主机变成新主机需要设置哨兵模式")]),s._v(" "),a("blockquote",[a("p",[s._v("复制原理")])]),s._v(" "),a("p",[s._v("从机只要连接到主机就会发送同步命令，主机将说句传送整个数据文件到slave，并完成同步。")]),s._v(" "),a("p",[s._v("如果主机断开了，从机使用 slaveof no one ，让自己变成主机。如果之前的主机回来了，那就只能从新连接了。")]),s._v(" "),a("h2",{attrs:{id:"哨兵模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式"}},[s._v("#")]),s._v(" 哨兵模式")]),s._v(" "),a("blockquote",[a("p",[s._v("自选谁当主机的模式")])]),s._v(" "),a("p",[s._v("后台监控主服务器是否故障，如果故障了根据投票数自动将从库转换为主库。")]),s._v(" "),a("p",[s._v("哨兵是独立的进程，独立运行。哨兵通过发送命令，等待redis服务器响应，从而监控运行的多个redis实例。")]),s._v(" "),a("p",[s._v("为了防止哨兵死了，也要配置多个哨兵互相监控。")]),s._v(" "),a("blockquote",[a("p",[s._v("一主二从的哨兵配置")])]),s._v(" "),a("p",[s._v("在配置文件下排位置 "),a("code",[s._v("sentinel.conf")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sentinel monitor  被监控名  127.0.0.1 6379 投票")]),s._v("\nsentinel monitor  myredis  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),a("p",[s._v("1代表主机挂了，slave投票让谁来替换为主机")]),s._v(" "),a("p",[s._v("启动哨兵")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("redis-sentinel myconfig/sentinel.conf\n")])])]),a("p",[s._v("当主机shutdown时会进行投票故障转移，从机中有一个会变成主机")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110950.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("优点")])]),s._v(" "),a("ol",[a("li",[s._v("基于主从配置")]),s._v(" "),a("li",[s._v("主从切换，故障转移")]),s._v(" "),a("li",[s._v("哨兵模式是主从模式的升级，手动到自动更加健壮")])]),s._v(" "),a("blockquote",[a("p",[s._v("缺点")])]),s._v(" "),a("ol",[a("li",[s._v("redis不可以在线扩容，集群容量一旦到达上限，在线扩容十分麻烦")]),s._v(" "),a("li",[s._v("全部的配置比较复杂")])]),s._v(" "),a("h2",{attrs:{id:"redis-缓存和雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-缓存和雪崩"}},[s._v("#")]),s._v(" Redis 缓存和雪崩")]),s._v(" "),a("h5",{attrs:{id:"缓存穿透-查不到"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透-查不到"}},[s._v("#")]),s._v(" 缓存穿透（查不到）")]),s._v(" "),a("p",[s._v("当用户想要查询一个数据，redis内存数据库里没有，于是想持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存未命中，于是都去请求持久层数据库。这会给持久层数据库造成很大的压力，这是就相当于出现了缓存穿透。")]),s._v(" "),a("blockquote",[a("p",[s._v("解决法案：")])]),s._v(" "),a("ul",[a("li",[s._v("在redis中增加过滤器")])]),s._v(" "),a("p",[s._v("布隆过滤器：一种数据结构，对所有可能的参数以hash形式存储，在控制层现在进行校验，不符合直接丢弃，从而避免对底层存储系统的查询压力")]),s._v(" "),a("ul",[a("li",[s._v("在redis中增加空缓存")])]),s._v(" "),a("p",[s._v("当缓存层未命中，存储层也没有时。存储层会返回一个空对象给缓存层并且设置一个过期时间，然后用户再去请求这个数据就回去缓存中拿，从而达到了保护后端数据的目的。")]),s._v(" "),a("blockquote",[a("p",[s._v("问题：")])]),s._v(" "),a("ol",[a("li",[s._v("空值也会被缓存，意味着缓存需要更多的空间来存储更多的没有值的键。")]),s._v(" "),a("li",[s._v("即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致。")])]),s._v(" "),a("h5",{attrs:{id:"缓存击穿-量太大-缓存过期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存击穿-量太大-缓存过期"}},[s._v("#")]),s._v(" 缓存击穿（量太大，缓存过期）")]),s._v(" "),a("p",[s._v("与缓存穿透不同时，缓存击穿是指某一个key的访问量极大，一直在被高并发地访问。当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。")]),s._v(" "),a("p",[s._v("一般这类数据是热点数据，在该key过期的瞬间，高并发会同时访问数据库查询最新数据，并且写会缓存，从而导致数据库压力过大。")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案")])]),s._v(" "),a("ul",[a("li",[s._v("设置热点数据永不过期")]),s._v(" "),a("li",[s._v("加互斥锁")])]),s._v(" "),a("p",[s._v("分布式锁：使用分布式锁，保证对于每个key同时只有一个进程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发地压力转移到了分布式锁，对分布式锁的考验也大。")]),s._v(" "),a("h5",{attrs:{id:"缓存雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存雪崩"}},[s._v("#")]),s._v(" 缓存雪崩")]),s._v(" "),a("p",[s._v("在某一个时间段，缓存集中过期，redis宕机。")]),s._v(" "),a("p",[s._v("比如双十一期间访问量过大，服务器提前把一些商品信息存到缓存中，都设置了1h的过期时间，那么一小时后key集体过期，如果访问量还是过大，所有的请求都会直接访问存储层，容易把服务器压垮。")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案")])]),s._v(" "),a("ul",[a("li",[s._v("服务降级")])]),s._v(" "),a("p",[s._v("停掉一些服务，保证主要的服务可用")]),s._v(" "),a("ul",[a("li",[s._v("redis高可用")])]),s._v(" "),a("p",[s._v("多设置几台redis，搭建集群")]),s._v(" "),a("ul",[a("li",[s._v("数据预热")])]),s._v(" "),a("p",[s._v("在正式部署之前，先把可能的数据先预先访问一边，这样部分可能大量访问的数据就会加载到缓存中。")])])}),[],!1,null,null,null);t.default=e.exports}}]);