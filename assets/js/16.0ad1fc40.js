(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{373:function(a,t,s){"use strict";s.r(t);var e=s(44),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"docker-基本操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-基本操作"}},[a._v("#")]),a._v(" Docker 基本操作")]),a._v(" "),s("blockquote",[s("p",[a._v("基于容器技术的轻量级虚拟化解决方案")])]),a._v(" "),s("ul",[s("li",[a._v("统一了基础设施")]),a._v(" "),s("li",[a._v("统一了程序打包方式")]),a._v(" "),s("li",[a._v("统一了程序部署(运行)方式")])]),a._v(" "),s("blockquote",[s("p",[a._v("资源隔离")])]),a._v(" "),s("h3",{attrs:{id:"quick-start"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#quick-start"}},[a._v("#")]),a._v(" Quick Start")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -d -p 80:80 docker/getting-started\n")])])]),s("p",[a._v("You'll notice a few flags being used. Here's some more info on them:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("-d")]),a._v(" - run the container in detached mode (in the background)")]),a._v(" "),s("li",[s("code",[a._v("-p 80:80")]),a._v(" - map port 80 of the host to port 80 in the container")]),a._v(" "),s("li",[s("code",[a._v("docker/getting-started")]),a._v(" - the image to use")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("docker hello-world\n")])])]),s("p",[a._v("To generate this message, Docker took the following steps:")]),a._v(" "),s("ol",[s("li",[a._v("The Docker client contacted the Docker daemon.")]),a._v(" "),s("li",[a._v('The Docker daemon pulled the "hello-world" image from the Docker Hub.\n(amd64)')]),a._v(" "),s("li",[a._v("The Docker daemon created a new container from that image which runs the\nexecutable that produces the output you are currently reading.")]),a._v(" "),s("li",[a._v("The Docker daemon streamed that output to the Docker client, which sent it\nto your terminal.")])]),a._v(" "),s("blockquote",[s("p",[a._v("镜像结构")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${registry_name}")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${repository_name}")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${image_name}")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${tag_name}")]),a._v("\n")])])]),s("ul",[s("li",[a._v("some simple command")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("docker login docker.in\ndocker pull alpine:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("release_version"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# check images")]),a._v("\ndocker images\ndocker search "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("images"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\ndocker tag 7731472c3f2a docker.io/danielgao/alpine:v3.10.3\n")])])]),s("blockquote",[s("p",[a._v("push images")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("docker push docker.io/danielgao/alpine:v3.10.3\n")])])]),s("blockquote",[s("p",[a._v("delete")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#delete tags")]),a._v("\ndocker rmi dokcer.io/danielgao/alpine:v3.10.3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#delete  images")]),a._v("\ndocker rmi -f "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("h3",{attrs:{id:"container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#container"}},[a._v("#")]),a._v(" Container")]),a._v(" "),s("p",[a._v("由镜像实例化而来")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" -a\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# setup a container")]),a._v("\ndocker run -ti danielgao/alpine:v3.10.3 /bin/sh\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  when exit  delete container")]),a._v("\ndocker run --rm "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("images"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂在后台")]),a._v("\ndocker run -d --name myContainer "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("images"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  /bin/sleep "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动停止的容器")]),a._v("\ndocker start "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("containerId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# enter a container  推出不会停止容器")]),a._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -ti "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("containerId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /bin/sh\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#docker stop")]),a._v("\ndocker stop "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("containerId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# -d : 后台运行. -P 将容器内部使用的网络端口随机映射到我们使用的主机上")]),a._v("\ndocker run -d -P training/webapp python app.py\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#delete container")]),a._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v("  id/name\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启一个容器")]),a._v("\ndocker run -itd centos /bin/bash\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#filter all exited container")]),a._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" -a -q"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("h3",{attrs:{id:"iamges"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iamges"}},[a._v("#")]),a._v(" Iamges")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#export images")]),a._v("\ndocker save "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("IMAGE ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" xxxx.tar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#remove iamges")]),a._v("\ndocker rmi -f "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("IMAGE ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#import")]),a._v("\ndocker load "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("  xxx.tar\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#re tag")]),a._v("\ndocker tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("IMAGE ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" danielgao/alpine:v3.10.3\n")])])]),s("h3",{attrs:{id:"查看日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看日志"}},[a._v("#")]),a._v(" 查看日志")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  让 docker logs 像使用 tail -f 一样来输出容器内部的标准输出。")]),a._v("\ndocker logs -f "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("container id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n")])])]),s("h3",{attrs:{id:"必要操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#必要操作"}},[a._v("#")]),a._v(" 必要操作")]),a._v(" "),s("blockquote",[s("p",[a._v("映射端口")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# -p 设置端口 -d 在后台 -rm 用完就删")]),a._v("\ndocker run -d  -p external:internal "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\ndocker run --rm --name mynigix -d  -p81:80 danielgao/nginx:v1.12.2 \n")])])]),s("blockquote",[s("p",[a._v("挂载数据卷")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#-v<宿主文件>:<容器> 挂载数据卷")]),a._v("\ndocker run -d --rm --name nginx_with_baidu -p82:80 -v/Users/gaoyan/dockerStudy:/usr/share/nginx/html danielgao/nginx:v1.12.2\n")])])]),s("p",[a._v("​\t关联文件系统")]),a._v(" "),s("blockquote",[s("p",[a._v("传递环境变量")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# - e 引入环境变量")]),a._v("\n\ndocker run --rm -e "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("E_OPTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("abc danielgao/nginx:v1.12.2 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("printenv")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("容器内 install tools")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将容器提交为镜像")]),a._v("\ndocker commit -p c95050c0cbff  danielgao/niginx:curl\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 推到公网")]),a._v("\ndocker push danielgao/nginx:v1.12.2\n")])])]),s("h3",{attrs:{id:"容器的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器的生命周期"}},[a._v("#")]),a._v(" 容器的生命周期")]),a._v(" "),s("ol",[s("li",[a._v("检索本地是否有镜像，没有就去远端找")]),a._v(" "),s("li",[a._v("利用镜像启动容器")]),a._v(" "),s("li",[a._v("分配文件系统，并在只读的镜像层挂载一个可读写层")]),a._v(" "),s("li",[a._v("从宿主机配置的网桥接口中桥接一个虚拟接口到容器")]),a._v(" "),s("li",[a._v("地址池分配ip")]),a._v(" "),s("li",[a._v("执行")]),a._v(" "),s("li",[a._v("执行完毕后终止")])]),a._v(" "),s("h3",{attrs:{id:"dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[a._v("#")]),a._v(" Dockerfile")]),a._v(" "),s("blockquote",[s("p",[a._v("构建镜像的源码")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#构建命令")]),a._v("\ndocker build .-t "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(":"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n\ndocker build "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" -t danielgao/nginx:v1.12.2_with_user_workdir\n\ndocker run  --rm -ti --name ngx123 danielgao/nginx:v1.12.2_with_user_workdir /bin/bash\n")])])]),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" danielgao/nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("v1.12.2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("USER")]),a._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /usr/share/nginx/html\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#把资源固化到容器里")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ADD")]),a._v(" index.html /user/share/nginx/html/index.html  \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#暴露端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("EXPOSE")]),a._v(" 80\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("7\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" VER=9.11.4\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" yum install bind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("$VER "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#cmd 指令")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" centos\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" yum install httpd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CMD")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"httpd"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-D"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"FOREGROUND"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#entrypoint.sh  默认的启动脚本")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" centos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("7\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ADD")]),a._v(" entrypoint.sh /entrypoint.sh\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" yum install epel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("release "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("q "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y && yum install nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("y\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENTRYPOINT")]),a._v("   /entrypoint.sh\n\n")])])]),s("p",[a._v("Entrypront.sh")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n/sbin/nginx -g "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"daemon off;"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#chomod +x entrypoint.sh")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);