(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{369:function(s,a,t){"use strict";t.r(a);var e=t(44),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis-进阶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-进阶"}},[s._v("#")]),s._v(" Redis 进阶")]),s._v(" "),t("h2",{attrs:{id:"redis-conf-详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-conf-详解"}},[s._v("#")]),s._v(" Redis.conf 详解")]),s._v(" "),t("p",[s._v("对大小写不明感")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-111020.png",alt:""}})]),s._v(" "),t("p",[s._v("可以导入外部配置")]),s._v(" "),t("blockquote",[t("p",[s._v("网络")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#绑定ip")]),s._v("\nprotect-mode  no "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#保护模式")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("通用")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("daemonize "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以守护进程的方式运行，后台运行")]),s._v("\n\npidfile /var/run/redis_6379.pid "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果以后台运行就要指定pid文件")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the server verbosity level.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This can be one of:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# debug (a lot of information, useful for development/testing)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# verbose (many rarely useful info, but not a mess like the debug level)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# notice (moderately verbose, what you want in production probably)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# warning (only very important / critical messages are logged)")]),s._v("\nloglevel notice\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成日志的文件名")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the log file name. Also the empty string can be used to force")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis to log on the standard output. Note that if you use standard")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# output for logging but daemonize, logs will be sent to /dev/null")]),s._v("\nlogfile "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n\n")])])]),t("blockquote",[t("p",[s._v("快照")])]),s._v(" "),t("p",[s._v("持久化，在规定时间内执行了多少次操作，则会持久化到文件。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110857.png",alt:""}})]),s._v(" "),t("p",[s._v("900s之内，如果至少一个key修改了就会持久化。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#持久化出错是否继续执行")]),s._v("\nstop-writes-on-bgsave-error "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否压缩drb文件")]),s._v("\nrdbcompression "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" ./ "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rdb文件保存目录")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("append only 模式    aof配置")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("appendonly no "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认不开启aof，因为大部分所有的情况家rdb完全够用")]),s._v("\nappendfilename "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly.aof"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认aof文件")]),s._v("\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync always 每次修改都会同步，消耗性能")]),s._v("\nappendfsync everysec  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒同步，可能会都是数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync no  #不同步，os自己同步，速度最快")]),s._v("\n\n")])])]),t("h2",{attrs:{id:"redis-持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化"}},[s._v("#")]),s._v(" Redis 持久化")]),s._v(" "),t("blockquote",[t("p",[s._v("RDB 与 AOF")])]),s._v(" "),t("p",[s._v("Redis 是内存数据库，所以要交内存中的数据保存到磁盘。故redis提供了持久化功能。")]),s._v(" "),t("h3",{attrs:{id:"rdb-fork进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rdb-fork进程"}},[s._v("#")]),s._v(" RDB：fork进程")]),s._v(" "),t("p",[s._v("在指定的时间间隔内将内存中的数据集快照写入磁盘（snapshot），恢复是将快照直接读到内存中。")]),s._v(" "),t("p",[s._v("redis会单独创建一个子进程持久化，它把数据写到临时文件中，持久化结束了，用这个临时文件替换之前的文件。")]),s._v(" "),t("p",[s._v("我们"),t("strong",[s._v("默认使用rdb")]),s._v("，一般情况下不需要修改这个配置。")]),s._v(" "),t("p",[s._v("rdb保存的文件是dump.rdb")]),s._v(" "),t("blockquote",[t("p",[s._v("触发机制")])]),s._v(" "),t("ol",[t("li",[s._v("save 的规则满足的情况下，会自动触发rdb规则")]),s._v(" "),t("li",[s._v("flushall也会触发")]),s._v(" "),t("li",[s._v("退出redis")])]),s._v(" "),t("blockquote",[t("p",[s._v("恢复rdb文件")])]),s._v(" "),t("p",[s._v("​\t只要把dump.rdb 放在redis启动目录下就可以，redis启动会自动检查")]),s._v(" "),t("blockquote",[t("p",[s._v("优劣")])]),s._v(" "),t("p",[s._v("优点：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("适合大规模的数据恢复")])]),s._v(" "),t("li",[t("p",[s._v("若对数据的完整性不高，可以使用")])])]),s._v(" "),t("p",[s._v("缺点：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("需要一定时间间隔进行操作，如果redis意外宕机了，最后一次修改数据就没有了")])]),s._v(" "),t("li",[t("p",[s._v("fork 子进程需要单独的空间")])])]),s._v(" "),t("h3",{attrs:{id:"aof-append-only-file-读写文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#aof-append-only-file-读写文件"}},[s._v("#")]),s._v(" AOF （append only file）：读写文件")]),s._v(" "),t("p",[s._v("以日志的形式来记录每个写操作，把redis所有执行过的指令都记录下来。"),t("strong",[s._v("只追加，不改写")]),s._v("。记录到 appendonly.aof中")]),s._v(" "),t("p",[s._v("若要开启，去配置文件修改：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("appendonly no "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认不开始，需要改为yes")]),s._v("\n")])])]),t("p",[s._v("若appendonly.aof被破坏，可以使用redis-check-aof 修复")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-check-aof --fix appendonly.aof\n")])])]),t("p",[s._v("优点：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync always 每次修改都会同步，消耗性能")]),s._v("\nappendfsync everysec  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒同步，可能会都是数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync no  #不同步，os自己同步，速度最快")]),s._v("\n")])])]),t("ul",[t("li",[t("p",[s._v("每一次修改都追加，文件完整性会更加好")])]),s._v(" "),t("li",[t("p",[s._v("每一秒同步一次可能会都是一秒的数据")])]),s._v(" "),t("li",[t("p",[s._v("从不同步，效率最高")])])]),s._v(" "),t("p",[s._v("缺点：")]),s._v(" "),t("ul",[t("li",[s._v("相对于数据文件来说，aof远远大于edb，修复速度慢")]),s._v(" "),t("li",[s._v("aof 运行效率也比rdb慢")])]),s._v(" "),t("h2",{attrs:{id:"redis-发布订阅"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-发布订阅"}},[s._v("#")]),s._v(" Redis 发布订阅")]),s._v(" "),t("p",[s._v("redis 发布订阅是一种"),t("strong",[s._v("消息通信模式")]),s._v("。发送者发消息，订阅者接收。")]),s._v(" "),t("blockquote",[t("p",[s._v("命令")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("psubsribe paettern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#订阅")]),s._v("\n\npubsub subcommand "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("argument "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("argument"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看订阅与发布系统状态")]),s._v("\n\npublish channnel message "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送信息")]),s._v("\n\npunsubsribe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pattern "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退订所有给定模式的频道")]),s._v("\n\nsubsribe channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#订阅给定的一个或多个频道信息")]),s._v("\n\nunsubsribe "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退订给定的频道")]),s._v("\n")])])]),t("p",[s._v("只要订阅了，一旦发布立马被推送。")]),s._v(" "),t("h2",{attrs:{id:"redis-主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从复制"}},[s._v("#")]),s._v(" Redis 主从复制")]),s._v(" "),t("p",[s._v("一台redis服务器(主节点)的数据，复制到其他的redis服务器（从节点）中。 数据只能从主节点复制到从节点是单向的。")]),s._v(" "),t("blockquote",[t("p",[s._v("主要作用")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("数据冗余：实现了数据的热备份，是持久化之外的一种数据冗余方式")])]),s._v(" "),t("li",[t("p",[s._v("故障恢复：主节点出问题时，从节点服务。")])]),s._v(" "),t("li",[t("p",[s._v("负载均衡：在主从复制的基础上，配合读写分离，主节点写，从节点读。分担服务器的负载。在写少读多的场景下，通过多个节点分担读负载，从而提高并发量")])]),s._v(" "),t("li",[t("p",[s._v("高可用(集群)：主从复制是哨兵模式和集群能够实施的基础")])])]),s._v(" "),t("p",[s._v("一般来说，工程项目中由于只有一台服务redis会宕机，单台redis内存最大使用"),t("strong",[s._v("内存不超过20gb")]),s._v("，所有必须配置集群。一般来说都是一主二从。")]),s._v(" "),t("blockquote",[t("p",[s._v("环境配置")])]),s._v(" "),t("p",[s._v("配置从库")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("info replication "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看redis当前库的信息")]),s._v("\n\n")])])]),t("p",[s._v("复制三个配置文件，配置一主二从的配置")]),s._v(" "),t("p",[s._v("修改每个配置文件的端口、pid、log文件、rdb文件名字")]),s._v(" "),t("blockquote",[t("p",[s._v("一主二从")])]),s._v(" "),t("p",[s._v("将6379作为主机，6380,6381作为从机")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("slaveof "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置从机")]),s._v("\n")])])]),t("p",[s._v("真实的主从配置要在配置文件中配置，用命令是暂时的")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v(" replicaof "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("tips")])]),s._v(" "),t("p",[s._v("主机只能写，从机只能读。")]),s._v(" "),t("p",[s._v("主机的信息会被从机保存。")]),s._v(" "),t("p",[s._v("如果主机宕机了，想要让从机接替主机变成新主机需要设置哨兵模式")]),s._v(" "),t("blockquote",[t("p",[s._v("复制原理")])]),s._v(" "),t("p",[s._v("从机只要连接到主机就会发送同步命令，主机将说句传送整个数据文件到slave，并完成同步。")]),s._v(" "),t("p",[s._v("如果主机断开了，从机使用 slaveof no one ，让自己变成主机。如果之前的主机回来了，那就只能从新连接了。")]),s._v(" "),t("h2",{attrs:{id:"哨兵模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式"}},[s._v("#")]),s._v(" 哨兵模式")]),s._v(" "),t("blockquote",[t("p",[s._v("自选谁当主机的模式")])]),s._v(" "),t("p",[s._v("后台监控主服务器是否故障，如果故障了根据投票数自动将从库转换为主库。")]),s._v(" "),t("p",[s._v("哨兵是独立的进程，独立运行。哨兵通过发送命令，等待redis服务器响应，从而监控运行的多个redis实例。")]),s._v(" "),t("p",[s._v("为了防止哨兵死了，也要配置多个哨兵互相监控。")]),s._v(" "),t("blockquote",[t("p",[s._v("一主二从的哨兵配置")])]),s._v(" "),t("p",[s._v("在配置文件下排位置 "),t("code",[s._v("sentinel.conf")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sentinel monitor  被监控名  127.0.0.1 6379 投票")]),s._v("\nsentinel monitor  myredis  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("1代表主机挂了，slave投票让谁来替换为主机")]),s._v(" "),t("p",[s._v("启动哨兵")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("redis-sentinel myconfig/sentinel.conf\n")])])]),t("p",[s._v("当主机shutdown时会进行投票故障转移，从机中有一个会变成主机")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110950.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("优点")])]),s._v(" "),t("ol",[t("li",[s._v("基于主从配置")]),s._v(" "),t("li",[s._v("主从切换，故障转移")]),s._v(" "),t("li",[s._v("哨兵模式是主从模式的升级，手动到自动更加健壮")])]),s._v(" "),t("blockquote",[t("p",[s._v("缺点")])]),s._v(" "),t("ol",[t("li",[s._v("redis不可以在线扩容，集群容量一旦到达上限，在线扩容十分麻烦")]),s._v(" "),t("li",[s._v("全部的配置比较复杂")])]),s._v(" "),t("h2",{attrs:{id:"redis-缓存和雪崩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-缓存和雪崩"}},[s._v("#")]),s._v(" Redis 缓存和雪崩")]),s._v(" "),t("h5",{attrs:{id:"缓存穿透-查不到"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存穿透-查不到"}},[s._v("#")]),s._v(" 缓存穿透（查不到）")]),s._v(" "),t("p",[s._v("当用户想要查询一个数据，redis内存数据库里没有，于是想持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存未命中，于是都去请求持久层数据库。这会给持久层数据库造成很大的压力，这是就相当于出现了缓存穿透。")]),s._v(" "),t("blockquote",[t("p",[s._v("解决法案：")])]),s._v(" "),t("ul",[t("li",[s._v("在redis中增加过滤器")])]),s._v(" "),t("p",[s._v("布隆过滤器：一种数据结构，对所有可能的参数以hash形式存储，在控制层现在进行校验，不符合直接丢弃，从而避免对底层存储系统的查询压力")]),s._v(" "),t("ul",[t("li",[s._v("在redis中增加空缓存")])]),s._v(" "),t("p",[s._v("当缓存层未命中，存储层也没有时。存储层会返回一个空对象给缓存层并且设置一个过期时间，然后用户再去请求这个数据就回去缓存中拿，从而达到了保护后端数据的目的。")]),s._v(" "),t("blockquote",[t("p",[s._v("问题：")])]),s._v(" "),t("ol",[t("li",[s._v("空值也会被缓存，意味着缓存需要更多的空间来存储更多的没有值的键。")]),s._v(" "),t("li",[s._v("即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致。")])]),s._v(" "),t("h5",{attrs:{id:"缓存击穿-量太大-缓存过期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存击穿-量太大-缓存过期"}},[s._v("#")]),s._v(" 缓存击穿（量太大，缓存过期）")]),s._v(" "),t("p",[s._v("与缓存穿透不同时，缓存击穿是指某一个key的访问量极大，一直在被高并发地访问。当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。")]),s._v(" "),t("p",[s._v("一般这类数据是热点数据，在该key过期的瞬间，高并发会同时访问数据库查询最新数据，并且写会缓存，从而导致数据库压力过大。")]),s._v(" "),t("blockquote",[t("p",[s._v("解决方案")])]),s._v(" "),t("ul",[t("li",[s._v("设置热点数据永不过期")]),s._v(" "),t("li",[s._v("加互斥锁")])]),s._v(" "),t("p",[s._v("分布式锁：使用分布式锁，保证对于每个key同时只有一个进程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发地压力转移到了分布式锁，对分布式锁的考验也大。")]),s._v(" "),t("h5",{attrs:{id:"缓存雪崩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存雪崩"}},[s._v("#")]),s._v(" 缓存雪崩")]),s._v(" "),t("p",[s._v("在某一个时间段，缓存集中过期，redis宕机。")]),s._v(" "),t("p",[s._v("比如双十一期间访问量过大，服务器提前把一些商品信息存到缓存中，都设置了1h的过期时间，那么一小时后key集体过期，如果访问量还是过大，所有的请求都会直接访问存储层，容易把服务器压垮。")]),s._v(" "),t("blockquote",[t("p",[s._v("解决方案")])]),s._v(" "),t("ul",[t("li",[s._v("服务降级")])]),s._v(" "),t("p",[s._v("停掉一些服务，保证主要的服务可用")]),s._v(" "),t("ul",[t("li",[s._v("redis高可用")])]),s._v(" "),t("p",[s._v("多设置几台redis，搭建集群")]),s._v(" "),t("ul",[t("li",[s._v("数据预热")])]),s._v(" "),t("p",[s._v("在正式部署之前，先把可能的数据先预先访问一边，这样部分可能大量访问的数据就会加载到缓存中。")])])}),[],!1,null,null,null);a.default=n.exports}}]);