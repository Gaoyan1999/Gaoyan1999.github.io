<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 进阶 | DanielGao&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hello World">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.84cbfe9a.js" as="script"><link rel="preload" href="/assets/js/2.97ad032c.js" as="script"><link rel="preload" href="/assets/js/14.9878853c.js" as="script"><link rel="prefetch" href="/assets/js/10.6f6050b0.js"><link rel="prefetch" href="/assets/js/11.314a169a.js"><link rel="prefetch" href="/assets/js/12.44c5ee57.js"><link rel="prefetch" href="/assets/js/13.f2574ab5.js"><link rel="prefetch" href="/assets/js/15.6fb7ebac.js"><link rel="prefetch" href="/assets/js/16.0ad1fc40.js"><link rel="prefetch" href="/assets/js/17.24a22417.js"><link rel="prefetch" href="/assets/js/18.f1919206.js"><link rel="prefetch" href="/assets/js/19.25662fd9.js"><link rel="prefetch" href="/assets/js/3.60832a0f.js"><link rel="prefetch" href="/assets/js/4.e7c996f5.js"><link rel="prefetch" href="/assets/js/5.6eff8140.js"><link rel="prefetch" href="/assets/js/6.17d5dd20.js"><link rel="prefetch" href="/assets/js/7.e59ee139.js"><link rel="prefetch" href="/assets/js/8.7162edc7.js"><link rel="prefetch" href="/assets/js/9.67af75ac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DanielGao's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Back End
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/back_end/docker_command.html" class="nav-link">
  Docker 命令
</a></li><li class="dropdown-subitem"><a href="/back_end/docker_jottings.html" class="nav-link">
  Docker 随笔
</a></li><li class="dropdown-subitem"><a href="/back_end/Kubernetes.html" class="nav-link">
  K8S
</a></li><li class="dropdown-subitem"><a href="/back_end/redis_start.html" class="nav-link">
  Redis Start
</a></li></ul></li><li class="dropdown-item"><h4>
          Algorithm notes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/basic_template.html" class="nav-link">
  常用算法模板
</a></li><li class="dropdown-subitem"><a href="/algorithm/PAT.html" class="nav-link">
  PAT tips
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便写写" class="dropdown-title"><span class="title">随便写写</span> <span class="arrow down"></span></button> <button type="button" aria-label="随便写写" class="mobile-dropdown-title"><span class="title">随便写写</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jottings/introduction.html" class="nav-link">
  前言
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Gaoyan1999" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习笔记" class="mobile-dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Back End
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/back_end/docker_command.html" class="nav-link">
  Docker 命令
</a></li><li class="dropdown-subitem"><a href="/back_end/docker_jottings.html" class="nav-link">
  Docker 随笔
</a></li><li class="dropdown-subitem"><a href="/back_end/Kubernetes.html" class="nav-link">
  K8S
</a></li><li class="dropdown-subitem"><a href="/back_end/redis_start.html" class="nav-link">
  Redis Start
</a></li></ul></li><li class="dropdown-item"><h4>
          Algorithm notes
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/algorithm/basic_template.html" class="nav-link">
  常用算法模板
</a></li><li class="dropdown-subitem"><a href="/algorithm/PAT.html" class="nav-link">
  PAT tips
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随便写写" class="dropdown-title"><span class="title">随便写写</span> <span class="arrow down"></span></button> <button type="button" aria-label="随便写写" class="mobile-dropdown-title"><span class="title">随便写写</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jottings/introduction.html" class="nav-link">
  前言
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Gaoyan1999" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis 进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#redis-conf-详解" class="sidebar-link">Redis.conf 详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#redis-持久化" class="sidebar-link">Redis 持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#rdb-fork进程" class="sidebar-link">RDB：fork进程</a></li><li class="sidebar-sub-header"><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#aof-append-only-file-读写文件" class="sidebar-link">AOF （append only file）：读写文件</a></li></ul></li><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#redis-发布订阅" class="sidebar-link">Redis 发布订阅</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#redis-主从复制" class="sidebar-link">Redis 主从复制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#哨兵模式" class="sidebar-link">哨兵模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/back_end/Redis%20%E8%BF%9B%E9%98%B6.html#redis-缓存和雪崩" class="sidebar-link">Redis 缓存和雪崩</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis-进阶"><a href="#redis-进阶" class="header-anchor">#</a> Redis 进阶</h1> <h2 id="redis-conf-详解"><a href="#redis-conf-详解" class="header-anchor">#</a> Redis.conf 详解</h2> <p>对大小写不明感</p> <p><img src="https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-111020.png" alt=""></p> <p>可以导入外部配置</p> <blockquote><p>网络</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0  <span class="token comment">#绑定ip</span>
protect-mode  no <span class="token comment">#保护模式</span>
</code></pre></div><blockquote><p>通用</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>daemonize <span class="token function">yes</span> <span class="token comment"># 以守护进程的方式运行，后台运行</span>

pidfile /var/run/redis_6379.pid <span class="token comment"># 如果以后台运行就要指定pid文件</span>


<span class="token comment"># 日志</span>

<span class="token comment"># Specify the server verbosity level.</span>
<span class="token comment"># This can be one of:</span>
<span class="token comment"># debug (a lot of information, useful for development/testing)</span>
<span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment"># notice (moderately verbose, what you want in production probably)</span>
<span class="token comment"># warning (only very important / critical messages are logged)</span>
loglevel notice

<span class="token comment">#生成日志的文件名</span>

<span class="token comment"># Specify the log file name. Also the empty string can be used to force</span>
<span class="token comment"># Redis to log on the standard output. Note that if you use standard</span>
<span class="token comment"># output for logging but daemonize, logs will be sent to /dev/null</span>
logfile <span class="token string">&quot;&quot;</span>


</code></pre></div><blockquote><p>快照</p></blockquote> <p>持久化，在规定时间内执行了多少次操作，则会持久化到文件。</p> <p><img src="https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110857.png" alt=""></p> <p>900s之内，如果至少一个key修改了就会持久化。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#持久化出错是否继续执行</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>
<span class="token comment">#是否压缩drb文件</span>
rdbcompression <span class="token function">yes</span>

<span class="token function">dir</span> ./ <span class="token comment">#rdb文件保存目录</span>
</code></pre></div><blockquote><p>append only 模式    aof配置</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>appendonly no <span class="token comment"># 默认不开启aof，因为大部分所有的情况家rdb完全够用</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span> <span class="token comment">#默认aof文件</span>



<span class="token comment"># appendfsync always 每次修改都会同步，消耗性能</span>
appendfsync everysec  <span class="token comment">#每秒同步，可能会都是数据</span>
<span class="token comment"># appendfsync no  #不同步，os自己同步，速度最快</span>

</code></pre></div><h2 id="redis-持久化"><a href="#redis-持久化" class="header-anchor">#</a> Redis 持久化</h2> <blockquote><p>RDB 与 AOF</p></blockquote> <p>Redis 是内存数据库，所以要交内存中的数据保存到磁盘。故redis提供了持久化功能。</p> <h3 id="rdb-fork进程"><a href="#rdb-fork进程" class="header-anchor">#</a> RDB：fork进程</h3> <p>在指定的时间间隔内将内存中的数据集快照写入磁盘（snapshot），恢复是将快照直接读到内存中。</p> <p>redis会单独创建一个子进程持久化，它把数据写到临时文件中，持久化结束了，用这个临时文件替换之前的文件。</p> <p>我们<strong>默认使用rdb</strong>，一般情况下不需要修改这个配置。</p> <p>rdb保存的文件是dump.rdb</p> <blockquote><p>触发机制</p></blockquote> <ol><li>save 的规则满足的情况下，会自动触发rdb规则</li> <li>flushall也会触发</li> <li>退出redis</li></ol> <blockquote><p>恢复rdb文件</p></blockquote> <p>​	只要把dump.rdb 放在redis启动目录下就可以，redis启动会自动检查</p> <blockquote><p>优劣</p></blockquote> <p>优点：</p> <ul><li><p>适合大规模的数据恢复</p></li> <li><p>若对数据的完整性不高，可以使用</p></li></ul> <p>缺点：</p> <ul><li><p>需要一定时间间隔进行操作，如果redis意外宕机了，最后一次修改数据就没有了</p></li> <li><p>fork 子进程需要单独的空间</p></li></ul> <h3 id="aof-append-only-file-读写文件"><a href="#aof-append-only-file-读写文件" class="header-anchor">#</a> AOF （append only file）：读写文件</h3> <p>以日志的形式来记录每个写操作，把redis所有执行过的指令都记录下来。<strong>只追加，不改写</strong>。记录到 appendonly.aof中</p> <p>若要开启，去配置文件修改：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>appendonly no <span class="token comment">#默认不开始，需要改为yes</span>
</code></pre></div><p>若appendonly.aof被破坏，可以使用redis-check-aof 修复</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-check-aof --fix appendonly.aof
</code></pre></div><p>优点：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># appendfsync always 每次修改都会同步，消耗性能</span>
appendfsync everysec  <span class="token comment">#每秒同步，可能会都是数据</span>
<span class="token comment"># appendfsync no  #不同步，os自己同步，速度最快</span>
</code></pre></div><ul><li><p>每一次修改都追加，文件完整性会更加好</p></li> <li><p>每一秒同步一次可能会都是一秒的数据</p></li> <li><p>从不同步，效率最高</p></li></ul> <p>缺点：</p> <ul><li>相对于数据文件来说，aof远远大于edb，修复速度慢</li> <li>aof 运行效率也比rdb慢</li></ul> <h2 id="redis-发布订阅"><a href="#redis-发布订阅" class="header-anchor">#</a> Redis 发布订阅</h2> <p>redis 发布订阅是一种<strong>消息通信模式</strong>。发送者发消息，订阅者接收。</p> <blockquote><p>命令</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>psubsribe paettern <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">#订阅</span>

pubsub subcommand <span class="token punctuation">[</span>argument <span class="token punctuation">[</span>argument<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># 查看订阅与发布系统状态</span>

publish channnel message <span class="token comment">#发送信息</span>

punsubsribe <span class="token punctuation">[</span>pattern <span class="token punctuation">[</span>pattern <span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#退订所有给定模式的频道</span>

subsribe channel <span class="token punctuation">[</span>channel <span class="token punctuation">..</span><span class="token punctuation">]</span> <span class="token comment">#订阅给定的一个或多个频道信息</span>

unsubsribe <span class="token punctuation">[</span>channel  <span class="token punctuation">[</span>channel <span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#退订给定的频道</span>
</code></pre></div><p>只要订阅了，一旦发布立马被推送。</p> <h2 id="redis-主从复制"><a href="#redis-主从复制" class="header-anchor">#</a> Redis 主从复制</h2> <p>一台redis服务器(主节点)的数据，复制到其他的redis服务器（从节点）中。 数据只能从主节点复制到从节点是单向的。</p> <blockquote><p>主要作用</p></blockquote> <ol><li><p>数据冗余：实现了数据的热备份，是持久化之外的一种数据冗余方式</p></li> <li><p>故障恢复：主节点出问题时，从节点服务。</p></li> <li><p>负载均衡：在主从复制的基础上，配合读写分离，主节点写，从节点读。分担服务器的负载。在写少读多的场景下，通过多个节点分担读负载，从而提高并发量</p></li> <li><p>高可用(集群)：主从复制是哨兵模式和集群能够实施的基础</p></li></ol> <p>一般来说，工程项目中由于只有一台服务redis会宕机，单台redis内存最大使用<strong>内存不超过20gb</strong>，所有必须配置集群。一般来说都是一主二从。</p> <blockquote><p>环境配置</p></blockquote> <p>配置从库</p> <div class="language-bash extra-class"><pre class="language-bash"><code>info replication <span class="token comment">#查看redis当前库的信息</span>

</code></pre></div><p>复制三个配置文件，配置一主二从的配置</p> <p>修改每个配置文件的端口、pid、log文件、rdb文件名字</p> <blockquote><p>一主二从</p></blockquote> <p>将6379作为主机，6380,6381作为从机</p> <div class="language-bash extra-class"><pre class="language-bash"><code>slaveof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token comment">#配置从机</span>
</code></pre></div><p>真实的主从配置要在配置文件中配置，用命令是暂时的</p> <div class="language-bash extra-class"><pre class="language-bash"><code> replicaof <span class="token operator">&lt;</span>masterip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>masterport<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>tips</p></blockquote> <p>主机只能写，从机只能读。</p> <p>主机的信息会被从机保存。</p> <p>如果主机宕机了，想要让从机接替主机变成新主机需要设置哨兵模式</p> <blockquote><p>复制原理</p></blockquote> <p>从机只要连接到主机就会发送同步命令，主机将说句传送整个数据文件到slave，并完成同步。</p> <p>如果主机断开了，从机使用 slaveof no one ，让自己变成主机。如果之前的主机回来了，那就只能从新连接了。</p> <h2 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h2> <blockquote><p>自选谁当主机的模式</p></blockquote> <p>后台监控主服务器是否故障，如果故障了根据投票数自动将从库转换为主库。</p> <p>哨兵是独立的进程，独立运行。哨兵通过发送命令，等待redis服务器响应，从而监控运行的多个redis实例。</p> <p>为了防止哨兵死了，也要配置多个哨兵互相监控。</p> <blockquote><p>一主二从的哨兵配置</p></blockquote> <p>在配置文件下排位置 <code>sentinel.conf</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#sentinel monitor  被监控名  127.0.0.1 6379 投票</span>
sentinel monitor  myredis  <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>
</code></pre></div><p>1代表主机挂了，slave投票让谁来替换为主机</p> <p>启动哨兵</p> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-sentinel myconfig/sentinel.conf
</code></pre></div><p>当主机shutdown时会进行投票故障转移，从机中有一个会变成主机</p> <p><img src="https://gaoyan1999.oss-cn-beijing.aliyuncs.com/md/2021-05-30-110950.png" alt=""></p> <blockquote><p>优点</p></blockquote> <ol><li>基于主从配置</li> <li>主从切换，故障转移</li> <li>哨兵模式是主从模式的升级，手动到自动更加健壮</li></ol> <blockquote><p>缺点</p></blockquote> <ol><li>redis不可以在线扩容，集群容量一旦到达上限，在线扩容十分麻烦</li> <li>全部的配置比较复杂</li></ol> <h2 id="redis-缓存和雪崩"><a href="#redis-缓存和雪崩" class="header-anchor">#</a> Redis 缓存和雪崩</h2> <h5 id="缓存穿透-查不到"><a href="#缓存穿透-查不到" class="header-anchor">#</a> 缓存穿透（查不到）</h5> <p>当用户想要查询一个数据，redis内存数据库里没有，于是想持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存未命中，于是都去请求持久层数据库。这会给持久层数据库造成很大的压力，这是就相当于出现了缓存穿透。</p> <blockquote><p>解决法案：</p></blockquote> <ul><li>在redis中增加过滤器</li></ul> <p>布隆过滤器：一种数据结构，对所有可能的参数以hash形式存储，在控制层现在进行校验，不符合直接丢弃，从而避免对底层存储系统的查询压力</p> <ul><li>在redis中增加空缓存</li></ul> <p>当缓存层未命中，存储层也没有时。存储层会返回一个空对象给缓存层并且设置一个过期时间，然后用户再去请求这个数据就回去缓存中拿，从而达到了保护后端数据的目的。</p> <blockquote><p>问题：</p></blockquote> <ol><li>空值也会被缓存，意味着缓存需要更多的空间来存储更多的没有值的键。</li> <li>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致。</li></ol> <h5 id="缓存击穿-量太大-缓存过期"><a href="#缓存击穿-量太大-缓存过期" class="header-anchor">#</a> 缓存击穿（量太大，缓存过期）</h5> <p>与缓存穿透不同时，缓存击穿是指某一个key的访问量极大，一直在被高并发地访问。当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库。</p> <p>一般这类数据是热点数据，在该key过期的瞬间，高并发会同时访问数据库查询最新数据，并且写会缓存，从而导致数据库压力过大。</p> <blockquote><p>解决方案</p></blockquote> <ul><li>设置热点数据永不过期</li> <li>加互斥锁</li></ul> <p>分布式锁：使用分布式锁，保证对于每个key同时只有一个进程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发地压力转移到了分布式锁，对分布式锁的考验也大。</p> <h5 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h5> <p>在某一个时间段，缓存集中过期，redis宕机。</p> <p>比如双十一期间访问量过大，服务器提前把一些商品信息存到缓存中，都设置了1h的过期时间，那么一小时后key集体过期，如果访问量还是过大，所有的请求都会直接访问存储层，容易把服务器压垮。</p> <blockquote><p>解决方案</p></blockquote> <ul><li>服务降级</li></ul> <p>停掉一些服务，保证主要的服务可用</p> <ul><li>redis高可用</li></ul> <p>多设置几台redis，搭建集群</p> <ul><li>数据预热</li></ul> <p>在正式部署之前，先把可能的数据先预先访问一边，这样部分可能大量访问的数据就会加载到缓存中。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.84cbfe9a.js" defer></script><script src="/assets/js/2.97ad032c.js" defer></script><script src="/assets/js/14.9878853c.js" defer></script>
  </body>
</html>
